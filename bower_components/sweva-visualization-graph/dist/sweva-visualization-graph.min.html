<html><head><meta charset="UTF-8"><script src="../bower_components/sigma/sigma.min.js"></script><script src="../bower_components/sigma/plugins/sigma.layout.forceAtlas2.min.js"></script><script src="../sigma/plugins/sigma.plugins.dragNodes.min.js"></script><script src="../bower_components/sigma/plugins/sigma.parsers.gexf.min.js"></script><script src="../bower_components/sigma/plugins/sigma.parsers.json.min.js"></script><script src="../bower_components/sigma/plugins/sigma.renderers.edgeLabels.min.js"></script><script src="../bower_components/sigma/plugins/sigma.plugins.filter.min.js"></script><script src="../bower_components/download-as-file/dist/download-as-file.js"></script><script src="../bower_components/sigma/plugins/sigma.exporters.svg.min.js"></script><script src="../sigma/plugins/sigma.exporters.gexf.js"></script></head><body><dom-module id="sweva-visualization-graph"><template><style>:host{display:block;box-sizing:border-box;font-family:sans-serif;background-color:#fff;position:absolute;color:#000;overflow:hidden;left:0;top:0;right:0;bottom:0;height:100%;width:100%;font-family:Roboto,Noto,sans-serif;-webkit-font-smoothing:antialiased;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.hidden{display:none!important}#sigma-canvas{position:absolute;top:36px;left:0;right:0;bottom:60px}#info-box{display:block;position:absolute;top:40px;left:10px;max-height:800px;overflow:auto;width:150px;background:#fff;box-shadow:1px 1px 5px #aaa}#info-box .inner{padding:8px 0}#info-box dl{margin:0}#info-box dt{font-size:12px;font-weight:600;letter-spacing:.011em;line-height:20px;background:#eee;padding:0 8px}#info-box dd{font-size:12px;font-weight:400;letter-spacing:.011em;line-height:20px;margin:0;overflow:hidden;text-overflow:ellipsis;text-overflow:ellipsis;text-align:right;word-break:break-all;max-height:40px;padding:0 8px}.menu{padding:8px}.title{height:36px;line-height:36px;font-size:20px;padding:8px;font-weight:600;max-width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-align:center}.horizontal-flex{display:flex;flex-direction:row;position:relative;align-items:center}.filters{border-top:1px solid #666;position:absolute;bottom:60px;width:100%;padding:8px;flex-wrap:wrap;background-color:rgba(255,255,255,.5)}label{font-size:12px;font-weight:400;letter-spacing:.011em;line-height:20px;display:block}.controls{border-top:1px solid #666;height:60px;position:absolute;left:0;right:0;bottom:0}.controls button{position:relative;display:block;overflow:hidden;border-width:0;outline:0;border-radius:2px;box-shadow:0 1px 4px #777;background-color:#fff;color:#000;padding:8px;margin:5px;text-transform:uppercase}.contols button:hover{background-color:#ddd}.horizontal-flex>*{flex:1}</style><div class="title">{{label}}</div><div id="sigma-canvas"></div><div id="info-box" class$="{{getInfoBoxClass(showInfoBox)}}" }=""><div class="inner"><dl><dt>Label</dt><dd style="text-align:left;height:40px;">{{display.label}}</dd><dt>Size</dt><dd>{{display.size}}</dd><dt>Degree</dt><dd>{{display.degree}}</dd><template is="dom-if" if="{{config.directed}}"><dt>In-Degree</dt><dd>{{display.inDegree}}</dd><dt>Out-Degree</dt><dd>{{display.outDegree}}</dd></template><template is="dom-repeat" items="{{display.attributes}}"><dt>{{item.key}}</dt><dd>{{item.value}}</dd></template></dl></div></div><div class="horizontal-flex filters"><div><label>Label</label> <input id="filter-label" type="text" value="" placeholder="prefix regex with r%"></div><div><label>Min. Degree</label> <input id="filter-degree" type="number" value="0" placeholder="0"></div><div><label>Custom</label> <input id="filter-key" type="text" value="" placeholder="key"> <input id="filter-value" type="text" value="" placeholder="(=|>|<) value"></div></div><div class="horizontal-flex controls"><div class="menu"><select id="export-select" name="select" style="width:100%"><option value="0" disabled="" selected="">Export as...</option><option value="1">SVG</option><option value="2">PNG</option><option value="2">GEXF (Gephi)</option></select></div><button id="reset-button">Reset</button></div><a id="hiddenLink" class="hidden"></a></template><script>class SwevaVisualizationGraph extends Polymer.Element{static get is(){return"sweva-visualization-graph"}static get properties(){return{data:{type:Object,value:{nodes:[],edges:[]}},config:{type:Object,value:{}},oldConfigJSON:{type:String,value:""},display:{type:Object,value:{}},label:{type:String,value:""},showInfoBox:{type:Boolean,value:!0}}}ready(){super.ready();try{sigma.classes.graph.addMethod("neighbors",function(e){var t,i={},a=this.allNeighborsIndex[e]||{};for(t in a)i[t]=this.nodesIndex[t];return i})}catch(e){}}connectedCallback(){super.connectedCallback(),Polymer.RenderStatus.beforeNextRender(this,function(){this.shadowRoot.querySelector("#export-select").addEventListener("click",this.handleExportClicked.bind(this),!1),this.shadowRoot.querySelector("#reset-button").addEventListener("click",this.handleReset.bind(this),!1),this.shadowRoot.querySelector("#filter-label").addEventListener("change",this.handleFilterLabel.bind(this),!1),this.shadowRoot.querySelector("#filter-degree").addEventListener("change",this.handleFilterDegree.bind(this),!1),this.shadowRoot.querySelector("#filter-key").addEventListener("change",this.handleFilterKey.bind(this),!1),this.shadowRoot.querySelector("#filter-value").addEventListener("change",this.handleFilterValue.bind(this),!1)})}set(e){if(this.initialized=!1,this.initialized){if(e.config){var t=JSON.stringify(e.config);t!==this.oldConfigJSON&&Object.keys(e.config).length>0&&(this.clear(),this.oldConfigJSON=t,this.config=e.config,this.setup(this.config))}}else this.clear(),this.config=e.config||{},this.oldConfigJSON=JSON.stringify(this.config),this.setup(this.config);if(e.data){if(0==e.data.nodes.length)return;this.data=e.data,this.update()}}getRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}setup(e){this.initialized=!0,this.config.label=e.label||"Graph",this.label=this.config.label,e.directed?this.config.directed=e.directed:this.config.directed=!1,e.curves?this.config.curves=e.curves:this.config.curves=!1,void 0!==e.showInfoBox?this.config.showInfoBox=e.showInfoBox:this.config.showInfoBox=!0,this.showInfoBox=this.config.showInfoBox,this.config.defaultNodeColor=e.defaultNodeColor||"#ec5148";var t=this;this.sigma=new sigma({graph:{nodesd:[],edges:[]},container:"sigma-canvas",renderers:[{container:this.$["sigma-canvas"],type:"canvas"}],settings:{defaultNodeColor:t.config.defaultNodeColor,edgeLabelSize:"proportional",defaultEdgeColor:"#777",defaultEdgeLabelColor:"#111",edgeLabelThreshold:2,minNodeSize:1,minArrowSize:6}}),this.filter=new sigma.plugins.filter(this.sigma),this.dragListener=sigma.plugins.dragNodes(this.sigma,this.sigma.renderers[0]),this.sigma.bind("clickNode",function(e){var i=e.data.node.id,a=t.sigma.graph.neighbors(i);a[i]=e.data.node,t.sigma.graph.nodes().forEach(function(e){a[e.id]?e.color=e.originalColor:e.color="#eee"}),t.sigma.graph.edges().forEach(function(e){a[e.source]&&a[e.target]?(e.color=e.originalColor,e.label=e.originalLabel):(e.color="#eee",e.label="")}),t.sigma.refresh()}),this.sigma.bind("doubleClickNode rightClickNode",function(e){this.dispatchEvent(new CustomEvent("nodeclicked",{bubbles:!0,composed:!0,detail:e.data.node.attributes}))}),this.sigma.bind("overNode",function(e){var i={};if(i.label=e.data.node.label||"none",i.size=parseInt(e.data.node.size||1),i.degree=t.sigma.graph.degree(e.data.node.id),i.inDegree=t.sigma.graph.degree(e.data.node.id,"in"),i.outDegree=t.sigma.graph.degree(e.data.node.id,"out"),i.attributes=[],e.data.node.attributes)for(var a=Object.keys(e.data.node.attributes),o=0;o<a.length;o++)i.attributes.push({key:a[o],value:e.data.node.attributes[a[o]]});t.display=i}),this.sigma.bind("clickStage",function(e){t.sigma.graph.nodes().forEach(function(e){e.color=e.originalColor}),t.sigma.graph.edges().forEach(function(e){e.color=e.originalColor}),t.sigma.refresh()})}handleFilterLabel(e){var t=e.target.value;this.filter.undo("label"),t.length>0&&(0==t.indexOf("r%")?(t=t.substring(2),t=new RegExp(t),this.filter.nodesBy(function(e){return e.label.search(t)>-1},"label")):this.filter.nodesBy(function(e){return e.label.indexOf(t)>-1},"label")),this.filter.apply()}handleFilterDegree(e){var t=e.target.value;this.filter.undo("degree");var i=this;t>0&&this.filter.nodesBy(function(e){return i.sigma.graph.degree(e.id)>=t},"degree"),this.filter.apply()}handleFilterCommon(e,t){if(this.filter.undo("custom"),t.length>0&&e.length>0){var i="";if(t.length>=2){var a=t.charAt(0),o=a+t.charAt(1);["<=",">=","==","=>","=<"].indexOf(o)>=0?(i="=>"==o?">=":"=<"==o?"<=":o,t=t.substring(2).trim()):["<",">","="].indexOf(a)>=0&&(i="="==a?"==":a,t=t.substring(1).trim())}this.filter.nodesBy(function(a){if(void 0===a.attributes||void 0===a.attributes[e])return!1;switch(i){case"<":return a.attributes[e]<t;case">":return a.attributes[e]>t;case"<=":return a.attributes[e]<=t;case">=":return a.attributes[e]>=t;case"==":default:return a.attributes[e]==t}},"custom")}this.filter.apply()}handleFilterKey(e){var t=e.target.value,i=this.shadowRoot.querySelector("#filter-value").value;this.handleFilterCommon(t,i)}handleFilterValue(e){var t=e.target.value,i=this.shadowRoot.querySelector("#filter-key").value;this.handleFilterCommon(i,t)}handleReset(){this.sigma.camera.goTo({x:0,y:0,ratio:1,angle:0}),this.shadowRoot.querySelector("#filter-label").value="",this.shadowRoot.querySelector("#filter-degree").value=0,this.shadowRoot.querySelector("#filter-key").value="",this.shadowRoot.querySelector("#filter-label").value="",this.filter.undo().apply(),this.filter.clear()}handleExportClicked(e){var t=e.target.selectedIndex;1==t?this.getSvg():2==t?this.getPng():3==t&&this.getGexf(),e.target.selectedIndex=0}getSvg(){this.sigma.toSVG({download:!0,filename:this.config.label+".svg"})}getPng(){var e=this.shadowRoot.querySelector("#sigma-canvas .sigma-scene"),t=(e.getContext("2d"),this.config.label),i=this.$.hiddenLink,a=e.toDataURL("image/png");i.download=t+".png",i.href=a,i.click()}getGexf(){this.sigma.toGEXF({download:!0,filename:this.config.label+".gexf",nodeAttributes:"attributes",edgeAttributes:"attributes",renderer:this.sigma.renderers[0],creator:"Sigma.js",description:"This is an awesome graph!"})}resize(e,t){}update(e){void 0!==e&&(this.data=e);for(var t=this,i=!0,a=0;a<this.data.nodes.length;a++){var o=this.data.nodes[a];void 0!==o.x&&void 0!==o.y||(i=!1,o.x=Math.random()*this.data.nodes.length,o.y=Math.random()*this.data.nodes.length),void 0===o.size&&(o.size=1)}t.sigma.refresh(),t.sigma.graph.clear(),t.sigma.graph.read(this.data),t.sigma.graph.nodes().forEach(function(e){e.originalColor=e.color}),t.sigma.graph.edges().forEach(function(e){e.type="line",e.color||(e.color=t.sigma.graph.nodes(e.source).color),t.config.curves?t.config.directed?e.type="curvedArrow":e.type="curve":t.config.directed?e.type="arrow":e.type="line",e.originalColor=e.color,e.originalLabel=e.label}),i?t.sigma.refresh():(t.sigma.startForceAtlas2({linLogMode:!0,gravity:2}),setTimeout(function(){t.sigma.stopForceAtlas2()},3e3))}clear(){for(var e=this.shadowRoot.querySelector("#sigma-canvas"),t=Polymer.dom(e).children,i=0;i<t.length;i++)Polymer.dom(e).removeChild(t[i]);Polymer.dom.flush(),this.sigma&&(this.sigma.graph.clear(),this.handleReset())}getInfoBoxClass(e){return e?"":"hidden"}}window.customElements.define(SwevaVisualizationGraph.is,SwevaVisualizationGraph);</script></dom-module></body></html>