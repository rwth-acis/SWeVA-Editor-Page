define(["visitor-as/as"],(function(e){"use strict";function t(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var n=t(e);const{CommonFlags:r,NodeKind:a,ElementKind:i}=n;function s(e){return e.internalName.startsWith("~")}function o(e,t){return 0!=(e.flags&t)}function c(e){var t;return(null===(t=e.getClass())||void 0===t?void 0:t.internalName)??e.toString()}function l(e){let t=e.parent;for(;t!==t.parent;)t=t.parent;return t}function u(e){return{returnType:c(e.signature.returnType),parameters:e.signature.parameterTypes.map((e=>c(e)))}}function f(e){var t;const n={},r=null===(t=e.getClass)||void 0===t?void 0:t.call(e);if(!r)return n;if(n[r.internalName]={id:r.id,byteSize:r.nextMemoryOffset},r.typeArguments)for(const e of r.typeArguments)Object.assign(n,f(e));return n}function p(e){const t={};return Object.assign(t,f(e.signature.returnType)),e.signature.parameterTypes.forEach((e=>Object.assign(t,f(e)))),t}return class{afterCompile(e){const t=this.program,n=[...t.elementsByDeclaration.values()].filter((e=>o(e,r.MODULE_EXPORT))).filter((e=>!s(e))).filter((e=>e.declaration.kind===a.FUNCTIONDECLARATION)),c=[...t.elementsByDeclaration.values()].filter((e=>o(e,r.DECLARE))).filter((e=>!s(e))).filter((e=>e.declaration.kind===a.FUNCTIONDECLARATION)),f={},g={};for(let e of c){if(!e.instances)continue;if(e.instances.size>1||!e.instances.has(""))throw Error("Can’t import or export generic functions.");let t,n;e=e.instances.get("");let r=e.declaration.decorators;if(r)for(let e of r)"external"===e.name.text&&e.args&&(e.args.length>1?(t=e.args[0].value,n=e.args[1].value):n=e.args[0].value);const a=t||l(e).internalName.split("/").slice(-1)[0];g.hasOwnProperty(a)||(g[a]={});let s=e.name;n?s=n:e.parent&&e.parent.kind===i.NAMESPACE&&(s=e.parent.name+"."+e.name),g[a][s]=u(e),Object.assign(f,p(e))}const d={};for(let e of n){if(e.instances.size>1||!e.instances.has(""))throw Error("Can’t import or export generic functions.");e=e.instances.get(""),d[e.name]=u(e),Object.assign(f,p(e))}this.typeData=JSON.stringify({typeIds:f,importedFunctions:g,exportedFunctions:d}),e.addCustomSection("as-bind_bindings",new TextEncoder("utf8").encode(this.typeData))}}}));
