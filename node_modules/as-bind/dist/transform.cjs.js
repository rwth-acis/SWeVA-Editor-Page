"use strict";function e(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var t=e(require("visitor-as/as"));const{CommonFlags:n,NodeKind:r,ElementKind:a}=t;function i(e){return e.internalName.startsWith("~")}function s(e,t){return 0!=(e.flags&t)}function o(e){var t;return(null===(t=e.getClass())||void 0===t?void 0:t.internalName)??e.toString()}function c(e){let t=e.parent;for(;t!==t.parent;)t=t.parent;return t}function l(e){return{returnType:o(e.signature.returnType),parameters:e.signature.parameterTypes.map((e=>o(e)))}}function u(e){var t;const n={},r=null===(t=e.getClass)||void 0===t?void 0:t.call(e);if(!r)return n;if(n[r.internalName]={id:r.id,byteSize:r.nextMemoryOffset},r.typeArguments)for(const e of r.typeArguments)Object.assign(n,u(e));return n}function f(e){const t={};return Object.assign(t,u(e.signature.returnType)),e.signature.parameterTypes.forEach((e=>Object.assign(t,u(e)))),t}module.exports=class{afterCompile(e){const t=this.program,o=[...t.elementsByDeclaration.values()].filter((e=>s(e,n.MODULE_EXPORT))).filter((e=>!i(e))).filter((e=>e.declaration.kind===r.FUNCTIONDECLARATION)),u=[...t.elementsByDeclaration.values()].filter((e=>s(e,n.DECLARE))).filter((e=>!i(e))).filter((e=>e.declaration.kind===r.FUNCTIONDECLARATION)),p={},g={};for(let e of u){if(!e.instances)continue;if(e.instances.size>1||!e.instances.has(""))throw Error("Can’t import or export generic functions.");let t,n;e=e.instances.get("");let r=e.declaration.decorators;if(r)for(let e of r)"external"===e.name.text&&e.args&&(e.args.length>1?(t=e.args[0].value,n=e.args[1].value):n=e.args[0].value);const i=t||c(e).internalName.split("/").slice(-1)[0];g.hasOwnProperty(i)||(g[i]={});let s=e.name;n?s=n:e.parent&&e.parent.kind===a.NAMESPACE&&(s=e.parent.name+"."+e.name),g[i][s]=l(e),Object.assign(p,f(e))}const d={};for(let e of o){if(e.instances.size>1||!e.instances.has(""))throw Error("Can’t import or export generic functions.");e=e.instances.get(""),d[e.name]=l(e),Object.assign(p,f(e))}this.typeData=JSON.stringify({typeIds:p,importedFunctions:g,exportedFunctions:d}),e.addCustomSection("as-bind_bindings",new TextEncoder("utf8").encode(this.typeData))}};
