<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-color-picker/paper-color-input.html">
<dom-module id="sweva-panel">
    <template>
        <style>
            :host {
                display: block;
                width: 300px;
                background-color: white;
                box-shadow: 0 2px 8px #555;
                position: relative;
            }

            paper-tabs, paper-toolbar {
                background-color: #0094ff;
                color: #fff;
                box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.2);
            }

                paper-toolbar paper-tabs {
                    box-shadow: none;
                }

                paper-tabs[noink][no-bar] paper-tab.iron-selected {
                    color: #ff6a00;
                }

            .tab-page {
                padding: 20px;
            }

            paper-button {
                background-color: #0094ff;
                color: #fff;
            }
        </style>

        <paper-tabs selected="{{selectedTab}}" noink>
            <paper-tab>Properties</paper-tab>
            <paper-tab>Save &amp; Load</paper-tab>
            <paper-tab>Settings</paper-tab>
        </paper-tabs>

        <iron-pages selected="{{selectedTab}}">
            <div class="tab-page">
                <span>{{selectedNode.name}}</span>
                <paper-input id="create-node-name" label="Name">MyNode</paper-input>
                <paper-button raised on-click="handleCreateNodeClick">Create</paper-button>

                <paper-button raised on-click="handleAutoLayoutClick">Layout</paper-button>
            </div>
            <div class="tab-page">
                Page 2
            </div>
            <div class="tab-page">
                <paper-input id="user-name" label="Username" value="{{username}}"></paper-input>
                <paper-color-input label="User Color" value="{{usercolor}}"></paper-color-input>
                <paper-button raised on-click="handleUserUpdateClick">Update</paper-button>
            </div>
        </iron-pages>
    </template>
    <script>
        (function () {
            'use strict';

            Polymer({
                is: 'sweva-panel',
                properties: {
                    selectedTab: {
                        type: Number,
                        value: 0
                    },
                    selectedNode: {
                        type: Object,
                        value: {
                            name: "hi"
                        }
                    },
                    username: {
                        type: String,
                        value: "User",

                    },
                    usercolor: {
                        type: Object,
                        value: {
                            red: 0,
                            green: 150,
                            blue: 136
                        }
                    }

                },
                ready: function () {

                },
                handleNodeSelected: function (event) {

                    if (event.detail.node) {
                        this.selectedNode = event.detail.node;
                    }
                    else {

                    }
                },
                handleAutoLayoutClick: function () {
                    this.fire('autolayout', {});
                },
                handleCreateNodeClick: function () {
                    var name = this.querySelector('#create-node-name').value;
                    if (name.trim().length == 0) {
                        name = "Node";
                    }
                    this.fire('createnode', { name: name });
                },
                handleUserUpdateClick: function () {

                    console.log('userdataupdated')

                    function componentToHex(c) {
                        var hex = c.toString(16);
                        return hex.length == 1 ? "0" + hex : hex;
                    }

                    this.fire('userdatachanged', {
                        name: this.username,
                        color: "#" + ((1 << 24) + (this.usercolor.red << 16) + (this.usercolor.green << 8) + this.usercolor.blue).toString(16).slice(1)
                    })

                },
                updateUser: function (data) {
                    
                    if (data.name) {
                        this.username = data.name;
                    }
                    if (data.color) {
                        
                        function hexToRgb(hex) {
                            // Expand shorthand form (e.g. "03F") to full form (e.g. "0033FF")
                            var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
                            hex = hex.replace(shorthandRegex, function (m, r, g, b) {
                                return r + r + g + g + b + b;
                            });

                            var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                            return result ? {
                                r: parseInt(result[1], 16),
                                g: parseInt(result[2], 16),
                                b: parseInt(result[3], 16)
                            } : null;
                        }
                        var color = hexToRgb(data.color);
                        var usercolor = {}
                        usercolor.red = color.r;
                        usercolor.green = color.g;
                        usercolor.blue = color.b;
                       
                        this.querySelector('paper-color-input').value = usercolor;
                        this.querySelector('paper-color-input').ready();
                    }
                }

            });
        })();
    </script>
</dom-module>